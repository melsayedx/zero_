<?xml version="1.0"?>
<clickhouse>
    <!-- Performance optimized configuration for 100k/sec log ingestion -->

    <!-- Logger settings -->
    <logger>
        <level>warning</level>
        <log>/var/log/clickhouse-server/clickhouse-server.log</log>
        <errorlog>/var/log/clickhouse-server/clickhouse-server.err.log</errorlog>
        <size>1000M</size>
        <count>10</count>
    </logger>

    <!-- HTTP server settings optimized for high throughput -->
    <http_server_default_response_keep_alive_ms>30000</http_server_default_response_keep_alive_ms>
    <max_connections>4096</max_connections>
    <keep_alive_timeout>30</keep_alive_timeout>

    <!-- Query processing -->
    <max_concurrent_queries>100</max_concurrent_queries>
    <max_threads>16</max_threads>

    <!-- Memory settings -->
    <max_memory_usage>4294967296</max_memory_usage> <!-- 4GB -->
    <max_memory_usage_for_user>3221225472</max_memory_usage_for_user> <!-- 3GB -->

    <!-- Cache settings -->
    <uncompressed_cache_size>2147483648</uncompressed_cache_size> <!-- 2GB -->
    <mark_cache_size>2147483648</mark_cache_size> <!-- 2GB -->

    <!-- Merge settings for background operations -->
    <background_pool_size>16</background_pool_size>
    <background_merges_max_memory_usage>1073741824</background_merges_max_memory_usage> <!-- 1GB -->

    <!-- Async insert optimization -->
    <async_insert_threads>16</async_insert_threads>
    <async_insert_max_data_size>10485760</async_insert_max_data_size> <!-- 10MB -->
    <async_insert_busy_timeout_ms>5000</async_insert_busy_timeout_ms>
    <async_insert_stale_timeout_ms>0</async_insert_stale_timeout_ms>

    <!-- Distributed processing -->
    <max_distributed_connections>1000</max_distributed_connections>
    <distributed_connections_pool_size>100</distributed_connections_pool_size>

    <!-- I/O settings for SSD storage -->
    <max_read_buffer_size>1048576</max_read_buffer_size> <!-- 1MB -->
    <max_write_buffer_size>1048576</max_write_buffer_size> <!-- 1MB -->

    <!-- Network settings -->
    <tcp_keep_alive_timeout>30</tcp_keep_alive_timeout>
    <tcp_connection_timeout>10</tcp_connection_timeout>

    <!-- Compression settings -->
    <compression>
        <case>
            <method>lz4</method>
        </case>
    </compression>

    <!-- Default settings for new databases -->
    <default_profile>
        <max_threads>8</max_threads>
        <max_memory_usage>1073741824</max_memory_usage> <!-- 1GB -->
        <max_memory_usage_for_user>805306368</max_memory_usage_for_user> <!-- 768MB -->
        <max_result_rows>10000</max_result_rows>
        <max_result_bytes>104857600</max_result_bytes> <!-- 100MB -->
        <read_overflow_mode>break</read_overflow_mode>
    </default_profile>
</clickhouse>
